var glb_RateTemp,glb_Currency="",glb_RecordInformation="(Gunjan Mohapatra)",glb_month=1,glb_monthStr="",glb_year=(new Date).getFullYear(),glb_HoursPerDay=0,glb_Rate=0,glb_HST=0,glc_HSTTemp=0,glb_CalendayArray=[],glb_WeekendCtr=0,glb_theWeekend="",glb_HideControls=!1,glb_TimeSheetRow=new Array(11),glb_TimeSheetRowExtra=new Array(2),glb_AnnualCalculation="",glb_DefaultExpense=!0;glb_TimeSheetRowExtra[0]="Internet",glb_TimeSheetRowExtra[1]="40";var glb_HolidayPay=0,glb_AllProjects=["Absence","Client","Consulting","Development","Emergency Closing","Holiday","Meeting","Private Appointment","Support","Testing","Vacation","Validating"],glb_DefaultProject=glb_AllProjects[2],glb_Holidays={"1/1/2019":"New Year's Day","4/19/2019":"Good Friday","4/22/2019":"Easter Monday","5/20/2019":"Victoria Day/National Patriots Day","7/1/2019":"Canada Day","9/2/2019":"Labor Day","10/14/2019":"Thanksgiving Day","11/11/2019":"Remembrance Day","12/25/2019":"Christmas Day","12/26/2019":"Boxing Day"},glb_TimeSheetData={Customer:"",Address:"",Phone:"",Email:"",RecordInformation:"",Month:"",Year:"",Hour:"",HolidayPay:"",Currency:"",Rate:"",HST:"",Weeks:[],Extra:[]},glb_rowTemplate={Weekend:"",Project:"",Su:"",Mo:"",Tu:"",We:"",Th:"",Fr:"",Sa:"",Hours:""},glb_rowExtraData={Description:"",Amount:""},glb_loadTimeSheetData={},glb_BillTo=[{Name:"ABC Company",Address:"TORONTO, ONTARIO, CANADA",Phone:"New Phone",Email:"",Hoursperday:"8",HolidayPay:"0",Rate:"50",Currency:" $ "},{Name:"XYZ Company",Address:"JERSEY CITY, NEW JERSEY, USA",Phone:"New Phone",Email:"",Hoursperday:"7.5",HolidayPay:"0",Rate:"65",Currency:"$"}],glb_CompanyDetails={Name:"GUNJAN MOHAPATRA Inc.",Address:"Toronto, Ontario, Canada",Phone:"New Phone",Email:""},glb_FilesOpen=new Array(13),glb_BillToStr="";function AddEvents(){document.getElementById("scrTimesheetTable").addEventListener("blur",function(e){TimeSheetBlur(e)},!0),document.getElementById("scrYear").value=glb_year,document.getElementById("scrHoursPerDay").value=glb_HoursPerDay,document.getElementById("scrRate").value=glb_Rate,document.getElementById("scrCompanyDetails").innerHTML=glb_CompanyDetails.Name,document.getElementById("scrCompanyAddress").innerHTML=glb_CompanyDetails.Address;var e=document.getElementById("scrBillTo");for(var t in glb_BillTo){var l=document.createElement("option");l.value=t,l.text=glb_BillTo[t].Name,e.appendChild(l)}getBillTo()}function getBillTo(){var e=document.getElementById("scrBillTo").value;glb_BillToStr=glb_BillTo[e].Name+", "+glb_BillTo[e].Address,document.getElementById("scrHoursPerDay").value=glb_BillTo[e].Hoursperday,document.getElementById("scrRate").value=glb_BillTo[e].Rate,glb_Currency=glb_BillTo[e].Currency,glb_HolidayPay=glb_BillTo[e].HolidayPay,DeleteAllRows(),GetAllValues()}function GetAllValues(){glb_year=document.getElementById("scrYear").value,glb_month=document.getElementById("selMonth").value,glb_year=document.getElementById("scrYear").value,glb_HoursPerDay=document.getElementById("scrHoursPerDay").value,glb_Rate=document.getElementById("scrRate").value,glb_HST=document.getElementById("scrHST").value;var e=document.getElementById("selMonth")[glb_month-1].innerHTML;glb_monthStr=e,""==glb_Rate&&""==glb_HST?isNaN(new Date(glb_theWeekend))?(document.getElementById("scrMessage").innerHTML="Timesheet for "+e+" "+glb_year+" "+glb_RecordInformation,document.getElementById("scrTimesheetTable").getElementsByTagName("tfoot")[3].rows[0].cells[0].innerHTML="</p>To: "+glb_BillToStr+"</p>"):(document.getElementById("scrMessage").innerHTML="Timesheet for week ending on "+glb_theWeekend+" "+glb_RecordInformation,document.getElementById("scrTimesheetTable").getElementsByTagName("tfoot")[3].rows[0].cells[0].innerHTML="<p>To: "+glb_BillToStr+"</p>"):(document.getElementById("scrMessage").innerHTML="Invoice for "+e+" "+glb_year+" "+glb_RecordInformation,document.getElementById("scrTimesheetTable").getElementsByTagName("tfoot")[3].rows[0].cells[0].innerHTML="<p>Bill to: "+glb_BillToStr+"</p>")}function CreateCalendar(){DeleteAllRows(),GetAllValues();var e,t=new Array(20),l=(e=new Date(glb_year,glb_month,0)).getDate(),n=1-(e=new Date(glb_year,glb_month-1,1)).getDay(),a=!1,o=glb_WeekendCtr=0,r=0;t[glb_WeekendCtr]=new Array(9);for(var s=n;s<=l;s++){e=new Date(glb_year,glb_month-1,s),t[glb_WeekendCtr][e.getDay()]=e.toLocaleDateString();var d=e.toLocaleDateString();glb_Holidays.hasOwnProperty(d)&&(a=!0,r++,t[++o]=new Array(9),t[o][7]=glb_Holidays[d]+" ("+d+")",t[o][8]="HOLIDAY",t[o][e.getDay()]="X"),6==e.getDay()&&(t[glb_WeekendCtr][7]=e.toLocaleDateString(),1==a?(a=!1,o=glb_WeekendCtr+=2*r,r=0):o=++glb_WeekendCtr,t[glb_WeekendCtr]=new Array(9))}glb_CalendayArray=t;for(var i=0;i<glb_WeekendCtr;i++)null!=glb_CalendayArray[i]&&AddTimesheetRow();1==glb_DefaultExpense&&AddAdditionalExpensesWithData(glb_TimeSheetRowExtra),TimeSheetBlur(null)}function TimeSheetBlur(e){GetAllValues();for(var t,l=10,n=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],a=n.rows.length,o=0,r=0,s=document.getElementById("scrTimesheetTable").getElementsByTagName("tfoot")[1],d=0,i=0,m="",g=0,c="",y=0;y<a;y++)if(n.rows[y].cells.length,o=0,"none"!=n.rows[y].style.display){for(var b=0;b<n.rows[y].cells.length;b++)if(1<b&&b<9){var u=parseFloat(n.rows[y].cells[b].getElementsByTagName("div")[0].innerText.trim());isNaN(u)||(o+=u)}r+=o,n.rows[y].cells[l-1].getElementsByTagName("div")[0].innerText=o}if(0!=glb_Rate?(d=r*glb_Rate,s.rows[0].cells[0].innerHTML="<br><b>Total Hours : "+r+"</b><br><b>Amount : "+glb_Currency+d+"</b> @ "+glb_Rate+" per hour <br>",0<d&&(glb_AnnualCalculation=glb_AnnualCalculation+glb_monthStr+","+glb_HoursPerDay+","+glb_Rate+","+r+","+d+",")):s.rows[0].cells[0].innerHTML="<br><b>Total Hours : "+r+"</b><br>",!document.getElementById("scrTimeSheetMode").checked){l=3,a=(n=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1]).rows.length,g=0,s=document.getElementById("scrTimesheetTable").getElementsByTagName("tfoot")[2];for(y=T=0;y<a;y++)if(n.rows[y].cells.length,"none"!=n.rows[y].style.display){var T=parseFloat(n.rows[y].cells[1].getElementsByTagName("div")[0].innerText.trim());isNaN(T)||(g+=T)}t=g+d,0<g&&(c="Subtotal : "+g+"<hr><b>Total Amount : "+glb_Currency+t+"</b>",glb_AnnualCalculation=glb_AnnualCalculation+g+"\n"),s.rows[0].cells[0].innerHTML="",0<glb_HST?0<t&&(0<g&&(c="Subtotal : "+g+"<hr>Amount : "+t),m=(m=c+"<br><br>Harmonised Sales Tax (HST) @ "+glb_HST+" % of Amount "+t+": "+(i=t*glb_HST/100)+"<br><br>")+"<b>Total Amount : "+glb_Currency+(t+i)+"</b>",s.rows[0].cells[0].innerHTML=m):s.rows[0].cells[0].innerHTML=c,s.style.display=""}}function AddTimesheetRow(){for(var e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],t=e.insertRow(e.rows.length),l=e.rows.length-1,n=(new Array(11),0);n<=10;n++){var a=AddCell(t,n,""),o=glb_CalendayArray[l][n-2];if(2<=n&&n<=8&&(isNaN(new Date(o))||(a.innerHTML=new Date(o).getDate())),2!=n&&8!=n||AddDiv(a,"&nbsp;",!0,"right"),n<2){var r=AddDiv(a,"&nbsp;",!0,"left");1==n&&("HOLIDAY"==glb_CalendayArray[l][8]?r.innerHTML="Holiday":r.innerHTML=glb_DefaultProject,r.addEventListener("dblclick",function(e){AddProjects(e)},!0),r.addEventListener("keyup",function(e){9!=e.keyCode&&AddProjects(e)},!0))}9==n&&AddDiv(a,"&nbsp;",!1,"right"),2<n&&n<8&&(isNaN(new Date(o))?AddDiv(a,null!=o?o:"&nbsp;",!0,"right"):glb_Holidays.hasOwnProperty(o)?AddDiv(a,0==glb_HolidayPay?0:glb_HolidayPay,!0,"right"):AddDiv(a,glb_HoursPerDay,!0,"right")),0==n&&l<glb_WeekendCtr&&(a.getElementsByTagName("div")[0].innerHTML=glb_CalendayArray[l][7]),10==n&&(AddCheckBox(a),AddButton(a,"Insert a subrow"))}}function InsertSubRow(e){for(var t=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],l=t.insertRow(e.target.parentNode.parentNode.rowIndex-2),n=(t.rows.length,0);n<=10;n++){var a=AddCell(l,n,"");if(2!=n&&8!=n||AddDiv(a,"&nbsp;",!0,"right"),n<2){var o=AddDiv(a,"&nbsp;",!0,"left");1==n&&(o.addEventListener("dblclick",function(e){AddProjects(e)},!0),o.addEventListener("keyup",function(e){9!=e.keyCode&&AddProjects(e)},!0))}9==n&&AddDiv(a,"&nbsp;",!1,"right"),2<n&&n<8&&AddDiv(a,"",!0,"right"),10==n&&AddCheckBox(a)}}function AddBlankTimeSheetRow(){for(var e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],t=e.insertRow(e.rows.length),l=0;l<=10;l++){var n=AddCell(t,l,"");if(2!=l&&8!=l||AddDiv(n,"&nbsp;",!0,"right"),l<2){var a=AddDiv(n,"&nbsp;",!0,"left");1==l&&(a.addEventListener("dblclick",function(e){AddProjects(e)},!0),a.addEventListener("keyup",function(e){9!=e.keyCode&&AddProjects(e)},!0))}9==l&&AddDiv(n,"&nbsp;",!1,"right"),2<l&&l<8&&AddDiv(n,"",!0,"right"),10==l&&(AddCheckBox(n),AddButton(n,"Insert a subrow"))}}function AddTimeSheetRowWithData(e){for(var t=e.length,l=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],n=l.insertRow(l.rows.length),a=GetCalanderData(e[0]),o=0;o<=t;o++){var r=AddCell(n,o,"");if(null!=a[o]&&(r.innerText=a[o]),2!=o&&8!=o||AddDiv(r,e[o],!0,"right"),o<2){var s=AddDiv(r,e[o],!0,"left");1==o&&(s.addEventListener("dblclick",function(e){AddProjects(e)},!0),s.addEventListener("keyup",function(e){9!=e.keyCode&&AddProjects(e)},!0))}9==o&&AddDiv(r,e[o],!1,"right"),2<o&&o<8&&AddDiv(r,e[o],!0,"right"),10==o&&(AddCheckBox(r),AddButton(r,"Insert a subrow"))}}function GetCalanderData(e){for(var t=new Date(e),l=t.getDate(),n=t.getMonth(),a=t.getFullYear(),o=l-6,r=new Array(10),s=0,d=0;d<r.length;d++)r[d]="";if(6==t.getDay())for(s=2;o<=l;o++,s++)t=new Date(a,n,o),r[s]=t.getDate();return r}function AddAdditionalExpenses(){document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[1].style.display="";for(var e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1],t=e.insertRow(e.rows.length),l=(e.rows.length,0);l<=2;l++){var n=AddCell(t,l,"");0==l&&(n.colSpan=9,AddDiv(n,"&nbsp;",!0,"left")),1==l&&AddDiv(n,"&nbsp;",!0,"right"),2==l&&AddCheckBox(n)}}function AddAdditionalExpensesWithData(e){document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[1].style.display="";for(var t=e.length,l=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1],n=l.insertRow(l.rows.length),a=(l.rows.length,0);a<=t;a++){var o=AddCell(n,a,"");0==a&&(o.colSpan=9,AddDiv(o,e[a],!0,"left")),1==a&&AddDiv(o,e[a],!0,"right"),2==a&&AddCheckBox(o)}}function AddCell(e,t,l){var n=e.insertCell(t);return n.innerHTML=l,n.style.color="gray",n.style.fontSize="9px",n.valign="bottom",e.appendChild(n),n}function AddCheckBox(e){var t=document.createElement("input");return t.setAttribute("type","checkbox"),e.appendChild(t),t}function AddDiv(e,t,l,n){var a=document.createElement("div");return a.innerHTML=t,a.style.color="black",a.style.width="100%",a.style.height="18px",a.style.border="0px solid red",a.style.fontFamily="arial",a.style.fontSize="12px",a.style.textAlign=n,a.contentEditable=l,a.style.position="relative",a.valign="bottom",e.appendChild(a),a}function AddButton(e,t){var l=document.createElement("Button");return l.innerHTML=t,l.addEventListener("click",function(e){InsertSubRow(e)},!0),e.appendChild(l),l}function AddProjects(e){var t;if(null!=e){if(1!=e.target.parentNode.cellIndex)return;t=e.target}var l=document.createElement("input");l.setAttribute("list","scrProjects"),l.style.width="70%",l.style.height="100%",l.style.border="0px solid silver",l.style.background="silver",l.style.color="black",l.style.fontFamily="arial",l.style.fontSize="12px",l.addEventListener("blur",function(){t.contentEditable="true",t.innerHTML=this.value});var n=document.createElement("datalist");n.setAttribute("id","scrProjects");for(var a=0;a<glb_AllProjects.length;a++){var o=document.createElement("option");o.text=glb_AllProjects[a],o.value=glb_AllProjects[a],n.appendChild(o)}document.body.appendChild(n),t.innerHTML="",t.appendChild(l),t.getElementsByTagName("input")[0].focus(),t.getElementsByTagName("input")[0].value=""}function ShowHideCalendar(){for(var e=document.getElementById("scrCalendarIndicator"),t=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],l=t.rows.length,n=0;n<l;n++)for(var a=0;a<t.rows[n].cells.length;a++)1<a&&a<9&&(e.checked?t.rows[n].cells[a].style.color="gray":t.rows[n].cells[a].style.color="whitesmoke",t.rows[n].cells[a].style.border="1px solid gray")}function SelectAllCheckBoxes(){var e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],t=e.rows.length,l=!1;glb_theWeekend="",document.getElementById("scrAllCheckBoxes").checked&&(l=!0);for(var n=0;n<t;n++)3<e.rows[n].cells.length&&(e.rows[n].cells[10].getElementsByTagName("input")[0].checked=l);t=(e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1]).rows.length;for(n=0;n<t;n++)e.rows[n].cells.length<=3&&(e.rows[n].cells[2].getElementsByTagName("input")[0].checked=l)}function ShowHideRows(){var e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],t=e.rows.length,l=0,n="";glb_theWeekend="";for(var a=0;a<t;a++)3<e.rows[a].cells.length&&(e.rows[a].cells[10].getElementsByTagName("input")[0].checked?(e.rows[a].style.display="none",e.rows[a].style.visibility="hidden",e.rows[a].cells[10].getElementsByTagName("input")[0].checked=!1,l++):(e.rows[a].style.display="",e.rows[a].style.visibility="visible",n=e.rows[a].cells[0].getElementsByTagName("div")[0].innerText,isNaN(new Date(n))||(glb_theWeekend=n)));t<=l?(document.getElementById("scrTimesheetTable").getElementsByTagName("tfoot")[1].style.display="none",document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[0].style.color="whitesmoke",document.getElementById("scrTimesheetTable").rows[0].cells[2].style.color="whitesmoke",document.getElementById("scrTimesheetTable").rows[0].cells[8].style.color="whitesmoke",document.getElementById("scrTimesheetTable").style.borderCollapse="collapse"):(0==l&&(glb_theWeekend=""),document.getElementById("scrTimesheetTable").getElementsByTagName("tfoot")[1].style.display="",document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[0].style.color="black",document.getElementById("scrTimesheetTable").rows[0].cells[2].style.color="red",document.getElementById("scrTimesheetTable").rows[0].cells[8].style.color="red",document.getElementById("scrTimesheetTable").style.borderCollapse="separate"),t=(e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1]).rows.length;var o=0;for(a=0;a<t;a++)e.rows[a].cells.length<=3&&(e.rows[a].cells[2].getElementsByTagName("input")[0].checked?(e.rows[a].style.display="none",e.rows[a].style.visibility="hidden",e.rows[a].cells[2].getElementsByTagName("input")[0].checked=!1,o++):(e.rows[a].style.display="",e.rows[a].style.visibility="visible"));document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[1].style.display=t<=o?"none":"",0<o||0<l?"Hide"==document.getElementById("btnHide").innerText&&(document.getElementById("btnHide").innerText="Unhide",document.getElementById("scrAllCheckBoxes").style.visibility="hidden"):(document.getElementById("btnHide").innerText="Hide",document.getElementById("scrAllCheckBoxes").style.visibility="visible",document.getElementById("scrAllCheckBoxes").checked=!1),TimeSheetBlur(null)}function ShowHideControls(){document.getElementById("scrCalendarIndicator");for(var e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],t=e.rows.length,l=0;l<t;l++)e.rows[l].cells[10].style.display=0==glb_HideControls?"none":"";t=(e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1]).rows.length;for(l=0;l<t;l++)e.rows[l].cells[2].style.display=0==glb_HideControls?"none":"";return 0==glb_HideControls?(glb_HideControls=!0,document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[0].rows[0].cells[10].style.display="none",void(document.getElementById("scrControls").style.display="none")):(glb_HideControls=!1,document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[0].rows[0].cells[10].style.display="",void(document.getElementById("scrControls").style.display="block"))}function ConfirmDelete(){1==confirm("Are you sure you want to delete selected record(s)?")&&DeleteRows()}function DeleteRows(){for(var e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],t=e.rows.length,l=0;l<t;)3<e.rows[l].cells.length&&e.rows[l].cells[10].getElementsByTagName("input")[0].checked&&(e.deleteRow(l),l--,t=e.rows.length),l++;for(t=(e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1]).rows.length,l=0;l<t;)3==e.rows[l].cells.length&&e.rows[l].cells[2].getElementsByTagName("input")[0].checked&&(e.deleteRow(l),l--,t=e.rows.length),l++;t<=0&&(document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[1].style.display="none"),TimeSheetBlur(null)}function DeleteAllRows(){for(var e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],t=e.rows.length;0<t;)e.deleteRow(0),t=e.rows.length;for(t=(e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1]).rows.length;0<t;)e.deleteRow(0),t=e.rows.length;document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[1].style.display="none",TimeSheetBlur(null)}function ReadFile(){glb_FilesOpen=new Array(13);var l="",e=document.getElementById("btnOpen").files.length,n=0;if(0<e){for(var t=0;t<e;t++){var a=document.getElementById("btnOpen").files[t],o=new FileReader;l="",o.onload=function(e){l=e.target.result;var t=JSON.parse(l).Month;glb_FilesOpen[t]=JSON.parse(l),n++},o.readAsText(a)}var r=setInterval(function(){n==e&&(clearInterval(r),document.getElementById("btnCreate").style.display="none",LoadMonths())},1)}}function LoadMonths(){for(var e=document.getElementById("scrLoadedMonths"),t=document.getElementById("selMonth"),l=1;l<=glb_FilesOpen.length;l++)if(null!=glb_FilesOpen[l]){var n=document.createElement("option");n.text=t[l-1].innerHTML,n.value=l,e.appendChild(n)}e.style.display="block",t.style.display="none"}function LoadMonthChange(){LoadData(document.getElementById("scrLoadedMonths").value)}function LoadData(e){if(DeleteAllRows(),(glb_loadTimeSheetData=glb_FilesOpen[e]).hasOwnProperty("Month")){glb_RecordInformation=glb_loadTimeSheetData.RecordInformation;for(var t=glb_loadTimeSheetData.Month,l=glb_loadTimeSheetData.Year,n=glb_loadTimeSheetData.Hour,a=glb_loadTimeSheetData.Rate.trim(),o=glb_loadTimeSheetData.HST,r="",s=document.getElementById("scrBillTo"),d=0;d<s.length;d++)if(s[s[d].value].innerHTML==glb_loadTimeSheetData.Customer){s.selectedIndex=s[d].value,s.disabled=!0;break}glb_BillToStr=glb_loadTimeSheetData.Customer+", "+glb_loadTimeSheetData.Address,glb_Currency=glb_loadTimeSheetData.Currency,glb_HolidayPay=glb_loadTimeSheetData.HolidayPay,document.getElementById("selMonth").value=t,document.getElementById("scrYear").value=l,document.getElementById("scrHoursPerDay").value=n,document.getElementById("scrRate").value=a,document.getElementById("scrHST").value=o;var i=document.getElementById("selMonth")[document.getElementById("selMonth").selectedIndex].innerHTML;if(r=""==a?"Timesheet for ":"Invoice for ",document.getElementById("scrMessage").innerHTML=r+i+"&nbsp;"+document.getElementById("scrYear").value,glb_loadTimeSheetData.hasOwnProperty("Weeks"))for(var m in glb_loadTimeSheetData.Weeks)glb_TimeSheetRow[0]=glb_loadTimeSheetData.Weeks[m].Weekend,glb_TimeSheetRow[1]=glb_loadTimeSheetData.Weeks[m].Project,glb_TimeSheetRow[2]=glb_loadTimeSheetData.Weeks[m].Su,glb_TimeSheetRow[3]=glb_loadTimeSheetData.Weeks[m].Mo,glb_TimeSheetRow[4]=glb_loadTimeSheetData.Weeks[m].Tu,glb_TimeSheetRow[5]=glb_loadTimeSheetData.Weeks[m].We,glb_TimeSheetRow[6]=glb_loadTimeSheetData.Weeks[m].Th,glb_TimeSheetRow[7]=glb_loadTimeSheetData.Weeks[m].Fr,glb_TimeSheetRow[8]=glb_loadTimeSheetData.Weeks[m].Sa,glb_TimeSheetRow[9]=glb_loadTimeSheetData.Weeks[m].Hours,AddTimeSheetRowWithData(glb_TimeSheetRow);if(glb_loadTimeSheetData.hasOwnProperty("Extra"))for(var g in glb_loadTimeSheetData.Extra)glb_TimeSheetRowExtra[0]=glb_loadTimeSheetData.Extra[g].Description,glb_TimeSheetRowExtra[1]=glb_loadTimeSheetData.Extra[g].Amount,AddAdditionalExpensesWithData(glb_TimeSheetRowExtra)}TimeSheetBlur(null)}function SaveData(){var e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[0],t=e.rows.length,l=document.getElementById("scrBillTo").value;glb_TimeSheetData.Customer=glb_BillTo[l].Name,glb_TimeSheetData.Address=glb_BillTo[l].Address,glb_TimeSheetData.Phone=glb_BillTo[l].Phone,glb_TimeSheetData.Email=glb_BillTo[l].Email,glb_TimeSheetData.HolidayPay=glb_BillTo[l].HolidayPay,glb_TimeSheetData.Currency=glb_BillTo[l].Currency,glb_TimeSheetData.RecordInformation=glb_RecordInformation,glb_TimeSheetData.Month=glb_month,glb_TimeSheetData.Year=glb_year,glb_TimeSheetData.Hour=glb_HoursPerDay,glb_TimeSheetData.Rate=glb_Rate,glb_TimeSheetData.HST=glb_HST;for(var n=0;n<t;n++)glb_rowTemplate.Weekend=e.rows[n].cells[0].getElementsByTagName("div")[0].innerText.trim(),glb_rowTemplate.Project=e.rows[n].cells[1].getElementsByTagName("div")[0].innerText.trim(),glb_rowTemplate.Su=e.rows[n].cells[2].getElementsByTagName("div")[0].innerText.trim(),glb_rowTemplate.Mo=e.rows[n].cells[3].getElementsByTagName("div")[0].innerText.trim(),glb_rowTemplate.Tu=e.rows[n].cells[4].getElementsByTagName("div")[0].innerText.trim(),glb_rowTemplate.We=e.rows[n].cells[5].getElementsByTagName("div")[0].innerText.trim(),glb_rowTemplate.Th=e.rows[n].cells[6].getElementsByTagName("div")[0].innerText.trim(),glb_rowTemplate.Fr=e.rows[n].cells[7].getElementsByTagName("div")[0].innerText.trim(),glb_rowTemplate.Sa=e.rows[n].cells[8].getElementsByTagName("div")[0].innerText.trim(),glb_rowTemplate.Hours=e.rows[n].cells[9].getElementsByTagName("div")[0].innerText.trim(),glb_TimeSheetData.Weeks[n]=JSON.parse(JSON.stringify(glb_rowTemplate));t=(e=document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1]).rows.length;for(n=0;n<t;n++)glb_rowExtraData.Description=e.rows[n].cells[0].getElementsByTagName("div")[0].innerText.trim(),glb_rowExtraData.Amount=e.rows[n].cells[1].getElementsByTagName("div")[0].innerText.trim(),glb_TimeSheetData.Extra[n]=JSON.parse(JSON.stringify(glb_rowExtraData));document.getElementById("debug").value=JSON.stringify(glb_TimeSheetData);var a=document.createElement("a"),o="InvoiceTimeSheetData_"+glb_RecordInformation+"_"+glb_monthStr+"_"+glb_year+".txt",r=document.createEvent("MouseEvents");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(glb_TimeSheetData))),a.setAttribute("download",o),r.initEvent("click",!0,!0),a.dispatchEvent(r),glb_TimeSheetData.Weeks.length=0,glb_TimeSheetData.Extra.length=0}function MonthRangeCalulation(){var e=1,t=[0,0,0,0,0,0,0,0,0,0,0,0,0];for(var l in glb_AnnualCalculation="",glb_Holidays)e=new Date(l).getMonth()+1,new Date(l).getFullYear()==glb_year&&(t[e]=t[e]+1);for(var n=document.getElementById("scrMonthsRange").value.split("-"),a=parseInt(n[0].trim()),o=parseInt(n[1].trim()),r=a;r<=o;r++)document.getElementById("selMonth").value=r,document.getElementById("selMonth")[document.getElementById("selMonth").selectedIndex].innerHTML,CreateCalendar(),glb_AnnualCalculation=glb_AnnualCalculation.replace(glb_monthStr+",",glb_monthStr+","+t[r]+",");glb_AnnualCalculation="Month,NoOfHolidays,HoursPerDay,Rate,TotalHours,Amount,Expenses\n"+glb_AnnualCalculation,document.getElementById("scrAnnuallyContainer").style.display="block",document.getElementById("scrAnnually").value=glb_AnnualCalculation,glb_AnnualCalculation=""}function LoadedMonthRangeCalulation(){var e=1,t=[0,0,0,0,0,0,0,0,0,0,0,0,0];for(var l in glb_AnnualCalculation="",glb_Holidays)e=new Date(l).getMonth()+1,new Date(l).getFullYear()==glb_year&&(t[e]=t[e]+1);for(var n=1;n<=glb_FilesOpen.length;n++)null!=glb_FilesOpen[n]&&(LoadData(n),glb_AnnualCalculation=glb_AnnualCalculation.replace(glb_monthStr+",",glb_monthStr+","+t[n]+","));glb_AnnualCalculation="Month,NoOfHolidays,HoursPerDay,Rate,TotalHours,Amount,Expenses\n"+glb_AnnualCalculation,document.getElementById("scrAnnuallyContainer").style.display="block",document.getElementById("scrAnnually").value=glb_AnnualCalculation,glb_AnnualCalculation=""}function TimesheetMode(){document.getElementById("scrTimeSheetMode").checked?(glb_RateTemp=document.getElementById("scrRate").value,glc_HSTTemp=document.getElementById("scrHST").value,document.getElementById("scrRate").value="",document.getElementById("scrHST").value="",document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[1].style.display="none",document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1].style.display="none",document.getElementById("scrTimesheetTable").getElementsByTagName("tfoot")[2].style.display="none"):(glb_Rate=glb_RateTemp,document.getElementById("scrRate").value=glb_Rate,document.getElementById("scrHST").value=glc_HSTTemp,document.getElementById("scrTimesheetTable").getElementsByTagName("thead")[1].style.display="",document.getElementById("scrTimesheetTable").getElementsByTagName("tbody")[1].style.display="",document.getElementById("scrTimesheetTable").getElementsByTagName("tfoot")[2].style.display=""),TimeSheetBlur(null)}